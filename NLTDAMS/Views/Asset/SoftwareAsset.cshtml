@model AMSUtilities.Models.SoftwareAssetModel
@using AMSUtilities.Enums
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Create Asset";
}
@using (Html.BeginForm("CreateSoftwareAsset", "Asset", FormMethod.Post, new { @id = "formCreateAsset", @class = "formAssetCreation" }))
{
    @Html.AntiForgeryToken()
    <div class="row">
        <div class="col-sm-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">Create Software Asset</h3>
                </div>
                <div class="box-body">
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    @Html.HiddenFor(model => model.AssetCategoryId, (int)AssetCategories.Software)
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label for="InvoiceNumber">Invoice</label>
                                <select id="invoiceId" name="InvoiceId" class="form-control">
                                    <option disabled selected value="">Please select value</option>
                                    <option value="1">00123</option>
                                    <option value="2">00124</option>
                                    <option value="3">00125</option>
                                </select>
                                @*@Html.ValidationMessageFor(model => model.InvoiceId, "", new { @class = "text-danger" })*@
                                @*<div class="col-sm-1 text-left">
                    <a data-toggle="modal" data-target="#createModal" data-select="assigned_user_select" class="btn btn-sm btn-default">New</a>
                </div>*@
                            </div>
                        </div>
                        @*<div class="col-sm-3">
            <label for="Asset_Category">Asset Category</label>
            @Html.DropDownListFor(model => model.AssetCategoryId, Model.AssetCategories, new { @id = "assetCategory", @class = "form-control", @disabled = "true" })
        </div>*@
                        <div class="col-sm-3">
                            <label for="Asset_Type">Asset Type</label>
                            @Html.DropDownListFor(model => model.AssetTypeID, Model.AssetTypes, new { @id = "assetType", @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.AssetTypeID, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label for="AssetName">Asset Name</label>
                                @Html.TextBoxFor(model => model.AssetName, "" as string, new { @id = "assetName", @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.AssetName, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label for="From">Serial Number</label>
                                @Html.TextBoxFor(model => model.SerialNumber, "" as string, new { @id = "serialNumber", @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.SerialNumber, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label for="From">Publisher</label>
                                @Html.TextBoxFor(model => model.ProductName, "" as string, new { @id = "publisher", @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.ProductName, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label for="From">Licence Number</label>
                                @Html.TextBoxFor(model => model.LicenceNumber, "" as string, new { @id = "licenceNumber", @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.LicenceNumber, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label for="From">Licence Purchase Date</label>
                                <div class='input-group date startDate'>
                                    @Html.TextBox("LicencePurchaseDate", DateTime.Now.ToString("MM/dd/yyyy"), new { @id = "licencePurchaseDate", @class = "form-control" })
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                                @Html.ValidationMessageFor(model => model.LicencePurchaseDate, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label for="To">Licence Expiry Date</label>
                                <div class='input-group date endDate'>
                                    @Html.TextBox("LicenceExpiryDate", "", new { @id = "licenceExpiryDate", @class = "form-control" })
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                                @Html.ValidationMessageFor(model => model.LicenceExpiryDate, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                    <div class="row">                       
                        <div class="col-sm-9">
                            <div class="form-group">
                                <label class="required" for="Reason">Software Description</label>
                                @Html.TextAreaFor(model => model.Comment, new { @cols = "20", @rows = "2", @id = "softWareDescription", @class = "form-control" })
                            </div>
                        </div>
                    </div>
                    <div id="partialPlaceHolder"></div>
                    <div class="row">
                        <div class="col-sm-6" style="float:right">
                            <button type="button" style="margin-left:10px" class="btn btn-primary pull-right" id="btnCancel">
                                CANCEL
                            </button>
                            <button type="submit" style="margin-left:10px" class="btn btn-primary pull-right" id="btnCreateAndClone" onclick="$('#cloneId').val(true)">
                                CREATE & CLONE
                            </button>
                            <button type="submit" class="btn btn-primary pull-right" id="btnCreate" onclick="$('#cloneId').val(false)">
                                CREATE
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            @Html.Hidden("isClone", false, new { @id = "cloneId" })
        </div>
    </div>
}
@Scripts.Render("~/bundles/jqueryval")
<script>
    $(function () {

        if ('@TempData["Message"]'!= null &&'@TempData["Message"]'!= ""&&'@TempData["MessageType"]'!= null &&'@TempData["MessageType"]'!= "")
         {
             DisplayMessage('@TempData["MessageType"]', '@TempData["Message"]')
         }
    $("#btnCancel").on("click", function () {
        var url = '@Url.Action("CreateAsset", "Asset")';
        document.getElementById("formCreateAsset").action = url;
        document.getElementById("formCreateAsset").submit();
    });
         $("#assetType").on("change", function () {
             var assetType = $(this).children("option:selected").val();
            // alert(assetType);
             $("#componentsTab").css("display", "block");
      var url =  '@Url.Action("ManageSoftwareComponents", "Asset")?assetType='+assetType;
      if (url != "" && url != null) {
        $("#partialPlaceHolder").load(url, function () {
            $('#partialPlaceHolder').fadeIn('fast');
        });
        }
     });
          @*$("#btnCreateAndClone").on("click", function () {
       $("#cloneId").val(true);
       var url = '@Url.Action("CreateSoftwareAsset", "Asset")';
        document.getElementById("formCreateAsset").action = url;
        document.getElementById("formCreateAsset").submit();
          });
           $("#btnCreate").on("click", function () {
        $("#cloneId").val(false);
       var url = '@Url.Action("CreateSoftwareAsset", "Asset")';
        document.getElementById("formCreateAsset").action = url;
        document.getElementById("formCreateAsset").submit();
    });*@
    });
      function createComponent(componentTypeId, assetCategoryId, dropdownId, componentNameId,descriptionId,compValidationId,descValidationId,modalId) {
    var componentName = $("#" + componentNameId).val();
    var description = $("#" + descriptionId).val();
    var error=false;
    if(componentName==null || componentName=="")
    {
    error=true;
     $("#" + compValidationId).css("display","block");
    }
    else
    {
      $("#" + compValidationId).css("display","none");
    }
     if(description==null || description=="")
    {
    error=true;
     $("#" + descValidationId).css("display","block");
    }
    else
    {
      $("#" + descValidationId).css("display","none");
    }

    var Component={
    ComponentTypeID:componentTypeId,
    ComponentName:componentName,
    Description : description
    };
    if(error==false)
    {
    $.ajax({
        url: '@Url.Action("CreateComponent","Asset")',
             type: 'POST',
             data: { component: Component },
              success: function(result) {
                 if(result!="Error" && result!="0" && result!=""){
                  addOption(componentName,result,dropdownId);
                 $("#"+modalId).modal("hide");
                 SuccessAlert("Component added successfully");
                 $("html, body").animate({ scrollTop: 0 }, "slow");

                }
                },
                failure: function(response) {
                    alert(response.responseText);
                },
                error: function(response) {
                    alert(response.responseText);
                }

        });
    }
    else
    {
    return false;
    }
    }
    function addOption(optionText,optionValue,selectId)
    {
            $('#'+selectId).append('<option value="'+optionValue+'">'+optionText+'</option>');
    }
</script>